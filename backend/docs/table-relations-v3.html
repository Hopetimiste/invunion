<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relations Tables - Invunion v3</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'default',
            er: { 
                useMaxWidth: true,
                layoutDirection: 'TB'
            }
        });
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .subtitle { color: #94a3b8; font-size: 1.1em; }
        
        .nav {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        .nav h3 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .nav-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .nav-link {
            background: rgba(59,130,246,0.1);
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            color: #60a5fa;
            transition: all 0.3s;
            border: 1px solid rgba(59,130,246,0.2);
            text-align: center;
        }
        
        .nav-link:hover {
            background: rgba(59,130,246,0.2);
            transform: translateY(-2px);
        }
        
        .section {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        h2 {
            color: #3b82f6;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(59,130,246,0.3);
        }
        
        h3 {
            color: #8b5cf6;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
        }
        
        .relation-card {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s;
        }
        
        .relation-card:hover {
            transform: translateX(5px);
            border-left-color: #8b5cf6;
        }
        
        .relation-title {
            font-size: 1.2em;
            color: #60a5fa;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .relation-desc {
            color: #cbd5e1;
            margin-bottom: 15px;
        }
        
        .relation-formula {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: #34d399;
            font-size: 1.1em;
            border: 1px solid #30363d;
            margin: 10px 0;
            text-align: center;
        }
        
        .relation-arrow {
            color: #ec4899;
            font-weight: bold;
            padding: 0 10px;
        }
        
        .relation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .detail-item {
            background: rgba(59,130,246,0.1);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(59,130,246,0.2);
        }
        
        .detail-label {
            color: #94a3b8;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            color: #e2e8f0;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .badge-new { background: rgba(16,185,129,0.2); color: #34d399; border: 1px solid rgba(16,185,129,0.3); }
        .badge-blue { background: rgba(59,130,246,0.2); color: #60a5fa; }
        .badge-purple { background: rgba(139,92,246,0.2); color: #a78bfa; }
        .badge-green { background: rgba(16,185,129,0.2); color: #34d399; }
        .badge-orange { background: rgba(245,158,11,0.2); color: #fbbf24; }
        .badge-pink { background: rgba(236,72,153,0.2); color: #f472b6; }
        
        .example-box {
            background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.05));
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .example-title {
            color: #60a5fa;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .example-content {
            color: #cbd5e1;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }
        
        .tree-line {
            color: #94a3b8;
            margin-left: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .summary-card h4 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .summary-list {
            list-style: none;
            padding: 0;
        }
        
        .summary-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #cbd5e1;
        }
        
        .summary-list li:last-child {
            border-bottom: none;
        }
        
        .count {
            background: rgba(59,130,246,0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            color: #60a5fa;
            float: right;
        }
        
        .trigger-box {
            background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(236,72,153,0.05));
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .trigger-title {
            color: #a78bfa;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .trigger-event {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            color: #cbd5e1;
        }
        
        .formula {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: #34d399;
            margin: 10px 0;
            border: 1px solid #30363d;
        }
        
        .chain-box {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #ec4899;
        }
        
        .chain-title {
            color: #f472b6;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .chain-step {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
            color: #cbd5e1;
        }
        
        .chain-step::before {
            content: '‚Üí';
            position: absolute;
            left: 10px;
            color: #ec4899;
            font-weight: bold;
        }
        
        .stats-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(6,182,212,0.05));
            border: 1px solid rgba(16,185,129,0.3);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
        }
        
        .stats-number {
            font-size: 4em;
            font-weight: 700;
            background: linear-gradient(90deg, #34d399, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stats-label {
            font-size: 1.2em;
            color: #94a3b8;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .nav-links { grid-template-columns: 1fr; }
            .summary-grid { grid-template-columns: 1fr; }
            .relation-details { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- HEADER -->
    <div class="header">
        <h1>üîó Relations entre Tables</h1>
        <p class="subtitle">Architecture v3 - Invunion Bank Reconciliation SaaS</p>
        <div style="margin-top: 15px;">
            <span class="badge badge-blue">35 Relations</span>
            <span class="badge badge-green">19 Tables</span>
            <span class="badge badge-purple">2 Triggers</span>
            <span class="badge badge-orange">11 Contraintes UNIQUE</span>
        </div>
    </div>

    <!-- NAVIGATION -->
    <div class="nav">
        <h3>üìã Navigation rapide</h3>
        <div class="nav-links">
            <a href="#niveau1" class="nav-link">üè¢ Hi√©rarchie</a>
            <a href="#niveau2" class="nav-link">üíº Entit√©s M√©tier</a>
            <a href="#niveau3" class="nav-link">üè¶ Banking</a>
            <a href="#niveau4" class="nav-link">üí≥ Transactions</a>
            <a href="#niveau5" class="nav-link">üìÑ Factures</a>
            <a href="#niveau6" class="nav-link">ü§ù Matching</a>
            <a href="#niveau7" class="nav-link">üîî Alertes</a>
            <a href="#niveau8" class="nav-link">üìä Reporting</a>
            <a href="#triggers" class="nav-link">üîÑ Triggers</a>
            <a href="#summary" class="nav-link">üìã R√©sum√©</a>
        </div>
    </div>

    <!-- STATS -->
    <div class="stats-box">
        <div class="stats-number">35</div>
        <div class="stats-label">Relations entre tables document√©es</div>
    </div>

    <!-- NIVEAU 1: HI√âRARCHIE -->
    <div class="section" id="niveau1">
        <h2>üè¢ NIVEAU 1 : Hi√©rarchie Organisation</h2>

        <div class="relation-card">
            <div class="relation-title">1. organizations ‚Üí tenants</div>
            <div class="relation-desc">Une organisation a plusieurs tenants (filiales/entit√©s)</div>
            <div class="relation-formula">
                organizations.id <span class="relation-arrow">‚Üí</span> tenants.organization_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Index</div>
                    <div class="detail-value">idx_tenants_org</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
Organization "Acme Corp"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Tenant "Acme France" (SIRET: 123...)</span><br>
<span class="tree-line">‚îú‚îÄ‚îÄ Tenant "Acme Germany" (SIRET: 456...)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Tenant "Acme Spain" (SIRET: 789...)</span>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">2. organizations ‚Üí organization_members</div>
            <div class="relation-desc">Une organisation a plusieurs membres</div>
            <div class="relation-formula">
                organizations.id <span class="relation-arrow">‚Üí</span> organization_members.organization_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">R√¥les</div>
                    <div class="detail-value">owner / admin / member</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">3. users ‚Üí organization_members</div>
            <div class="relation-desc">Un utilisateur peut √™tre membre de plusieurs organisations</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> organization_members.user_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">Many-to-Many</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Contrainte</div>
                    <div class="detail-value">UNIQUE (org_id, user_id)</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
User "John Doe"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Member of "Acme Corp" (role: owner)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Member of "Beta Inc" (role: admin)</span>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">4. tenants ‚Üí tenant_members</div>
            <div class="relation-desc">Un tenant a plusieurs membres</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> tenant_members.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">R√¥les</div>
                    <div class="detail-value">admin / editor / viewer</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">5. users ‚Üí tenant_members</div>
            <div class="relation-desc">Un utilisateur peut √™tre membre de plusieurs tenants</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> tenant_members.user_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">Many-to-Many</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Contrainte</div>
                    <div class="detail-value">UNIQUE (tenant_id, user_id)</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
User "Jane Smith"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Member of "Acme France" (role: admin)</span><br>
<span class="tree-line">‚îú‚îÄ‚îÄ Member of "Acme Germany" (role: editor)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Member of "Acme Spain" (role: viewer)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NIVEAU 2: ENTIT√âS M√âTIER -->
    <div class="section" id="niveau2">
        <h2>üíº NIVEAU 2 : Entit√©s M√©tier</h2>

        <div class="relation-card">
            <div class="relation-title">6. tenants ‚Üí clients <span class="badge badge-new">NOUVEAU</span></div>
            <div class="relation-desc">Un tenant a plusieurs clients (ceux qui vous paient)</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> clients.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Usage</div>
                    <div class="detail-value">Factures √âMISES</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">7. tenants ‚Üí suppliers</div>
            <div class="relation-desc">Un tenant a plusieurs fournisseurs (ceux que vous payez)</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> suppliers.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Usage</div>
                    <div class="detail-value">Factures RE√áUES</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NIVEAU 3: BANKING -->
    <div class="section" id="niveau3">
        <h2>üè¶ NIVEAU 3 : Banking</h2>

        <div class="relation-card">
            <div class="relation-title">8. tenants ‚Üí bank_connections</div>
            <div class="relation-desc">Un tenant a plusieurs connexions bancaires</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> bank_connections.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Providers</div>
                    <div class="detail-value">Tink, GoCardless, Salt Edge, Plaid</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">PSD2</div>
                    <div class="detail-value">Renouvellement 90 jours</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">9. users ‚Üí bank_connections</div>
            <div class="relation-desc">Un utilisateur cr√©e des connexions bancaires</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> bank_connections.user_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">10. bank_connections ‚Üí bank_accounts</div>
            <div class="relation-desc">Une connexion bancaire a plusieurs comptes</div>
            <div class="relation-formula">
                bank_connections.id <span class="relation-arrow">‚Üí</span> bank_accounts.connection_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Contrainte</div>
                    <div class="detail-value">UNIQUE (connection_id, provider_account_id)</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
Bank Connection "Tink - BNP Paribas"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Account "Compte Courant" (IBAN: FR76...)</span><br>
<span class="tree-line">‚îú‚îÄ‚îÄ Account "Compte √âpargne" (IBAN: FR77...)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Account "Compte Pro" (IBAN: FR78...)</span>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">11. tenants ‚Üí bank_accounts</div>
            <div class="relation-desc">Un tenant poss√®de plusieurs comptes bancaires</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> bank_accounts.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NIVEAU 4: TRANSACTIONS -->
    <div class="section" id="niveau4">
        <h2>üí≥ NIVEAU 4 : Transactions</h2>

        <div class="relation-card">
            <div class="relation-title">12. tenants ‚Üí transactions</div>
            <div class="relation-desc">Un tenant a plusieurs transactions</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> transactions.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Index</div>
                    <div class="detail-value">idx_transactions_tenant</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">13. bank_accounts ‚Üí transactions</div>
            <div class="relation-desc">Un compte bancaire a plusieurs transactions</div>
            <div class="relation-formula">
                bank_accounts.id <span class="relation-arrow">‚Üí</span> transactions.account_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Note</div>
                    <div class="detail-value">Garde l'historique si compte supprim√©</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">14. suppliers ‚Üí transactions</div>
            <div class="relation-desc">Un fournisseur peut √™tre li√© √† plusieurs transactions (paiements sortants)</div>
            <div class="relation-formula">
                suppliers.id <span class="relation-arrow">‚Üí</span> transactions.supplier_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Direction</div>
                    <div class="detail-value">Paiements SORTANTS</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">15. clients ‚Üí transactions <span class="badge badge-new">NOUVEAU</span></div>
            <div class="relation-desc">Un client peut √™tre li√© √† plusieurs transactions (paiements entrants)</div>
            <div class="relation-formula">
                clients.id <span class="relation-arrow">‚Üí</span> transactions.client_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Direction</div>
                    <div class="detail-value">Paiements ENTRANTS</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
Client "Entreprise XYZ"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Transaction +5000‚Ç¨ (paiement facture #INV-001)</span><br>
<span class="tree-line">‚îú‚îÄ‚îÄ Transaction +3000‚Ç¨ (paiement facture #INV-002)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Transaction +2000‚Ç¨ (paiement facture #INV-003)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NIVEAU 5: FACTURES -->
    <div class="section" id="niveau5">
        <h2>üìÑ NIVEAU 5 : Factures</h2>

        <div class="relation-card">
            <div class="relation-title">16. tenants ‚Üí invoice_providers</div>
            <div class="relation-desc">Un tenant a plusieurs providers de facturation connect√©s</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> invoice_providers.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Providers</div>
                    <div class="detail-value">Pennylane, Stripe, QuickBooks, Xero</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">17. tenants ‚Üí invoices</div>
            <div class="relation-desc">Un tenant a plusieurs factures</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> invoices.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Index</div>
                    <div class="detail-value">idx_invoices_tenant</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">18. invoice_providers ‚Üí invoices</div>
            <div class="relation-desc">Un provider de facturation synchronise plusieurs factures</div>
            <div class="relation-formula">
                invoice_providers.id <span class="relation-arrow">‚Üí</span> invoices.provider_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">19. suppliers ‚Üí invoices</div>
            <div class="relation-desc">Un fournisseur √©met plusieurs factures (factures RE√áUES)</div>
            <div class="relation-formula">
                suppliers.id <span class="relation-arrow">‚Üí</span> invoices.supplier_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Usage</div>
                    <div class="detail-value">invoice_type = 'received'</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
Supplier "EDF"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Invoice "√âlectricit√© Jan 2026" (received)</span><br>
<span class="tree-line">‚îú‚îÄ‚îÄ Invoice "√âlectricit√© F√©v 2026" (received)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Invoice "√âlectricit√© Mar 2026" (received)</span>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">20. clients ‚Üí invoices <span class="badge badge-new">NOUVEAU</span></div>
            <div class="relation-desc">Un client re√ßoit plusieurs factures (factures √âMISES)</div>
            <div class="relation-formula">
                clients.id <span class="relation-arrow">‚Üí</span> invoices.client_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Usage</div>
                    <div class="detail-value">invoice_type = 'issued'</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Analytics</div>
                    <div class="detail-value">Auto-calcul payment_score</div>
                </div>
            </div>
            <div class="example-box">
                <div class="example-title">üí° Exemple</div>
                <div class="example-content">
Client "Entreprise XYZ"<br>
<span class="tree-line">‚îú‚îÄ‚îÄ Invoice #INV-001 (issued, 5000‚Ç¨)</span><br>
<span class="tree-line">‚îú‚îÄ‚îÄ Invoice #INV-002 (issued, 3000‚Ç¨)</span><br>
<span class="tree-line">‚îî‚îÄ‚îÄ Invoice #INV-003 (issued, 2000‚Ç¨)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NIVEAU 6: MATCHING -->
    <div class="section" id="niveau6">
        <h2>ü§ù NIVEAU 6 : Rapprochements (Matching)</h2>

        <div class="relation-card">
            <div class="relation-title">21. tenants ‚Üí matches</div>
            <div class="relation-desc">Un tenant a plusieurs rapprochements</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> matches.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">22. transactions ‚Üí matches</div>
            <div class="relation-desc">Une transaction peut √™tre rapproch√©e √† plusieurs factures (partiel)</div>
            <div class="relation-formula">
                transactions.id <span class="relation-arrow">‚Üí</span> matches.transaction_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Partiel</div>
                    <div class="detail-value">‚úÖ Support√©</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">23. invoices ‚Üí matches</div>
            <div class="relation-desc">Une facture peut √™tre rapproch√©e √† plusieurs transactions (partiel)</div>
            <div class="relation-formula">
                invoices.id <span class="relation-arrow">‚Üí</span> matches.invoice_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Partiel</div>
                    <div class="detail-value">‚úÖ Support√©</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">24. crypto_transactions ‚Üí matches</div>
            <div class="relation-desc">Une transaction crypto peut √™tre rapproch√©e √† une facture</div>
            <div class="relation-formula">
                crypto_transactions.id <span class="relation-arrow">‚Üí</span> matches.crypto_transaction_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Statut</div>
                    <div class="detail-value">üîú Futur</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">25. users ‚Üí matches</div>
            <div class="relation-desc">Un utilisateur cr√©e des rapprochements manuels</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> matches.matched_by
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Note</div>
                    <div class="detail-value">NULL si match IA automatique</div>
                </div>
            </div>
        </div>

        <div class="example-box">
            <div class="example-title">üí° Flux complet de matching</div>
            <div class="example-content">
Transaction +5000‚Ç¨ (Client XYZ)<br>
<span class="tree-line">‚Üì MATCH (confidence: 95%, type: ai_auto)</span><br>
Invoice #INV-001 (5000‚Ç¨, Client XYZ)<br>
<span class="tree-line">‚Üì TRIGGER: update_invoice_recovery()</span><br>
Invoice.recovery_percent = 100%<br>
Invoice.status = 'paid'<br>
<span class="tree-line">‚Üì TRIGGER: update_client_payment_analytics()</span><br>
Client.payment_score = 98%<br>
Client.avg_payment_days = 12<br>
Client.total_paid += 5000‚Ç¨
            </div>
        </div>
    </div>

    <!-- NIVEAU 7: ALERTES -->
    <div class="section" id="niveau7">
        <h2>üîî NIVEAU 7 : Alertes & Notifications</h2>

        <div class="relation-card">
            <div class="relation-title">26. tenants ‚Üí alerts</div>
            <div class="relation-desc">Un tenant a plusieurs alertes</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> alerts.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">27. users ‚Üí alerts</div>
            <div class="relation-desc">Un utilisateur re√ßoit plusieurs alertes</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> alerts.user_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Types</div>
                    <div class="detail-value">new_match, low_confidence, anomaly, sync_error, overdue_invoice</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">28. matches ‚Üí alerts</div>
            <div class="relation-desc">Un match peut g√©n√©rer une alerte</div>
            <div class="relation-formula">
                matches.id <span class="relation-arrow">‚Üí</span> alerts.related_match_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">29. invoices ‚Üí alerts</div>
            <div class="relation-desc">Une facture peut g√©n√©rer des alertes (ex: overdue)</div>
            <div class="relation-formula">
                invoices.id <span class="relation-arrow">‚Üí</span> alerts.related_invoice_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NIVEAU 8: REPORTING -->
    <div class="section" id="niveau8">
        <h2>üìä NIVEAU 8 : Reporting & Imports</h2>

        <div class="relation-card">
            <div class="relation-title">30. tenants ‚Üí reports</div>
            <div class="relation-desc">Un tenant a plusieurs rapports (cache)</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> reports.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">31. tenants ‚Üí import_jobs</div>
            <div class="relation-desc">Un tenant a plusieurs jobs d'import</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> import_jobs.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Formats</div>
                    <div class="detail-value">CSV, JSON</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">32. users ‚Üí import_jobs</div>
            <div class="relation-desc">Un utilisateur cr√©e des imports CSV</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> import_jobs.user_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE SET NULL</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">33. tenants ‚Üí audit_log</div>
            <div class="relation-desc">Un tenant a un journal d'audit</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> audit_log.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">Aucun (garde l'historique)</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">34. users ‚Üí audit_log</div>
            <div class="relation-desc">Un utilisateur g√©n√®re des entr√©es d'audit</div>
            <div class="relation-formula">
                users.id <span class="relation-arrow">‚Üí</span> audit_log.user_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">Aucun (garde l'historique)</div>
                </div>
            </div>
        </div>

        <div class="relation-card">
            <div class="relation-title">35. tenants ‚Üí crypto_transactions</div>
            <div class="relation-desc">Un tenant a plusieurs transactions crypto</div>
            <div class="relation-formula">
                tenants.id <span class="relation-arrow">‚Üí</span> crypto_transactions.tenant_id
            </div>
            <div class="relation-details">
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">One-to-Many (1:N)</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Cascade</div>
                    <div class="detail-value">ON DELETE CASCADE</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Statut</div>
                    <div class="detail-value">üîú Futur</div>
                </div>
            </div>
        </div>
    </div>

    <!-- TRIGGERS -->
    <div class="section" id="triggers">
        <h2>üîÑ Triggers Auto-Calcul√©s</h2>

        <div class="trigger-box">
            <div class="trigger-title">Trigger 1: update_invoice_recovery()</div>
            <div class="trigger-event">
                <strong>D√©clench√© par:</strong> INSERT, UPDATE, DELETE sur <code>matches</code>
            </div>
            <div class="trigger-event">
                <strong>Action:</strong> Recalcule automatiquement sur <code>invoices</code>:
                <ul style="margin-top: 10px; margin-left: 20px;">
                    <li><code>recovery_percent</code> (% de la facture couverte)</li>
                    <li><code>status</code> (unpaid ‚Üí partial ‚Üí paid)</li>
                </ul>
            </div>
            <div class="formula">
recovery_percent = (SUM(matches.matched_amount) / invoice.amount_incl_vat) * 100
            </div>
        </div>

        <div class="trigger-box">
            <div class="trigger-title">Trigger 2: update_client_payment_analytics() <span class="badge badge-new">NOUVEAU</span></div>
            <div class="trigger-event">
                <strong>D√©clench√© par:</strong> INSERT, UPDATE, DELETE sur <code>matches</code>
            </div>
            <div class="trigger-event">
                <strong>Action:</strong> Recalcule automatiquement sur <code>clients</code>:
                <ul style="margin-top: 10px; margin-left: 20px;">
                    <li><code>payment_score</code> (0-100%)</li>
                    <li><code>avg_payment_days</code> (d√©lai moyen)</li>
                    <li><code>total_invoiced</code></li>
                    <li><code>total_paid</code></li>
                    <li><code>last_invoice_date</code></li>
                    <li><code>last_payment_date</code></li>
                    <li><code>invoice_count</code></li>
                </ul>
            </div>
            <div class="formula">
payment_score = (total_paid / total_invoiced) * 100
<br><br>
avg_payment_days = AVG(transaction_date - invoice_date)
            </div>
        </div>
    </div>

    <!-- CHA√éNES COMPL√àTES -->
    <div class="section">
        <h2>üîó Cha√Ænes de Relations Compl√®tes</h2>

        <div class="chain-box">
            <div class="chain-title">Cha√Æne 1: Facture √âMISE ‚Üí Paiement</div>
            <div class="chain-step">Organization</div>
            <div class="chain-step">Tenant</div>
            <div class="chain-step">Client</div>
            <div class="chain-step">Invoice (issued)</div>
            <div class="chain-step">Match</div>
            <div class="chain-step">Transaction (incoming)</div>
            <div class="chain-step">Bank Account</div>
            <div class="chain-step">Bank Connection</div>
        </div>

        <div class="chain-box">
            <div class="chain-title">Cha√Æne 2: Facture RE√áUE ‚Üí Paiement</div>
            <div class="chain-step">Organization</div>
            <div class="chain-step">Tenant</div>
            <div class="chain-step">Supplier</div>
            <div class="chain-step">Invoice (received)</div>
            <div class="chain-step">Match</div>
            <div class="chain-step">Transaction (outgoing)</div>
            <div class="chain-step">Bank Account</div>
            <div class="chain-step">Bank Connection</div>
        </div>

        <div class="chain-box">
            <div class="chain-title">Cha√Æne 3: Permissions Utilisateur</div>
            <div class="chain-step">User</div>
            <div class="chain-step">Organization Member (role: owner/admin/member)</div>
            <div class="chain-step">Organization</div>
            <div class="chain-step">Tenant</div>
            <div class="chain-step">Tenant Member (role: admin/editor/viewer)</div>
            <div class="chain-step">Access to Tenant Data</div>
        </div>
    </div>

    <!-- R√âSUM√â -->
    <div class="section" id="summary">
        <h2>üìã R√©sum√© par Table</h2>

        <div class="summary-grid">
            <div class="summary-card">
                <h4>üè¢ organizations</h4>
                <ul class="summary-list">
                    <li>‚Üí tenants <span class="count">1:N</span></li>
                    <li>‚Üí organization_members <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üè≠ tenants</h4>
                <ul class="summary-list">
                    <li>‚Üí bank_connections <span class="count">1:N</span></li>
                    <li>‚Üí bank_accounts <span class="count">1:N</span></li>
                    <li>‚Üí transactions <span class="count">1:N</span></li>
                    <li>‚Üí invoices <span class="count">1:N</span></li>
                    <li>‚Üí suppliers <span class="count">1:N</span></li>
                    <li>‚Üí clients <span class="count badge-new">1:N NEW</span></li>
                    <li>‚Üí matches <span class="count">1:N</span></li>
                    <li>‚Üí alerts <span class="count">1:N</span></li>
                    <li>‚Üí reports <span class="count">1:N</span></li>
                    <li>‚Üí import_jobs <span class="count">1:N</span></li>
                    <li>‚Üí invoice_providers <span class="count">1:N</span></li>
                    <li>‚Üí crypto_transactions <span class="count">1:N</span></li>
                    <li>‚Üí audit_log <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üë§ users</h4>
                <ul class="summary-list">
                    <li>‚Üí organization_members <span class="count">M:N</span></li>
                    <li>‚Üí tenant_members <span class="count">M:N</span></li>
                    <li>‚Üí bank_connections <span class="count">1:N</span></li>
                    <li>‚Üí matches <span class="count">1:N</span></li>
                    <li>‚Üí alerts <span class="count">1:N</span></li>
                    <li>‚Üí import_jobs <span class="count">1:N</span></li>
                    <li>‚Üí audit_log <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üíº clients <span class="badge badge-new">NEW</span></h4>
                <ul class="summary-list">
                    <li>‚Üí invoices (issued) <span class="count">1:N</span></li>
                    <li>‚Üí transactions (incoming) <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üè™ suppliers</h4>
                <ul class="summary-list">
                    <li>‚Üí invoices (received) <span class="count">1:N</span></li>
                    <li>‚Üí transactions (outgoing) <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üè¶ bank_connections</h4>
                <ul class="summary-list">
                    <li>‚Üí bank_accounts <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üè¶ bank_accounts</h4>
                <ul class="summary-list">
                    <li>‚Üí transactions <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üìÑ invoice_providers</h4>
                <ul class="summary-list">
                    <li>‚Üí invoices <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üìÑ invoices</h4>
                <ul class="summary-list">
                    <li>‚Üí matches <span class="count">1:N</span></li>
                    <li>‚Üí alerts <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üí≥ transactions</h4>
                <ul class="summary-list">
                    <li>‚Üí matches <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>üíé crypto_transactions</h4>
                <ul class="summary-list">
                    <li>‚Üí matches <span class="count">1:N</span></li>
                </ul>
            </div>

            <div class="summary-card">
                <h4>ü§ù matches</h4>
                <ul class="summary-list">
                    <li>‚Üí alerts <span class="count">1:N</span></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- SCH√âMA VISUEL ERD -->
    <div class="section">
        <h2>üé® Sch√©ma Visuel de la Base de Donn√©es</h2>
        <p style="color: #94a3b8; margin-bottom: 20px;">
            Diagramme Entity-Relationship montrant toutes les tables et leurs relations dans l'architecture v3.
        </p>
        
        <div style="background: #ffffff; border-radius: 12px; padding: 30px; margin: 20px 0;">
            <div class="mermaid">
erDiagram
    %% ============================================
    %% NIVEAU 1: HI√âRARCHIE
    %% ============================================
    
    organizations ||--o{ tenants : "has many"
    organizations ||--o{ organization_members : "has many"
    
    users ||--o{ organization_members : "member of"
    users ||--o{ tenant_members : "member of"
    
    tenants ||--o{ tenant_members : "has many"
    
    %% ============================================
    %% NIVEAU 2: ENTIT√âS M√âTIER
    %% ============================================
    
    tenants ||--o{ clients : "has many"
    tenants ||--o{ suppliers : "has many"
    
    %% ============================================
    %% NIVEAU 3: BANKING
    %% ============================================
    
    tenants ||--o{ bank_connections : "has many"
    users ||--o{ bank_connections : "created by"
    bank_connections ||--o{ bank_accounts : "has many"
    tenants ||--o{ bank_accounts : "owns"
    
    %% ============================================
    %% NIVEAU 4: TRANSACTIONS
    %% ============================================
    
    tenants ||--o{ transactions : "has many"
    bank_accounts ||--o{ transactions : "source of"
    suppliers ||--o{ transactions : "paid to"
    clients ||--o{ transactions : "paid by"
    
    %% ============================================
    %% NIVEAU 5: FACTURES
    %% ============================================
    
    tenants ||--o{ invoice_providers : "connected to"
    tenants ||--o{ invoices : "has many"
    invoice_providers ||--o{ invoices : "synced from"
    suppliers ||--o{ invoices : "received from"
    clients ||--o{ invoices : "issued to"
    
    %% ============================================
    %% NIVEAU 6: MATCHING
    %% ============================================
    
    tenants ||--o{ matches : "has many"
    transactions ||--o{ matches : "matched in"
    invoices ||--o{ matches : "matched in"
    crypto_transactions ||--o{ matches : "matched in"
    users ||--o{ matches : "created by"
    
    %% ============================================
    %% NIVEAU 7: ALERTES & AUTRES
    %% ============================================
    
    tenants ||--o{ alerts : "has many"
    users ||--o{ alerts : "receives"
    matches ||--o{ alerts : "triggers"
    invoices ||--o{ alerts : "related to"
    
    tenants ||--o{ reports : "has many"
    tenants ||--o{ import_jobs : "has many"
    users ||--o{ import_jobs : "created by"
    
    tenants ||--o{ crypto_transactions : "has many"
    tenants ||--o{ audit_log : "logged for"
    users ||--o{ audit_log : "performed by"
    
    %% ============================================
    %% D√âFINITIONS DES TABLES
    %% ============================================
    
    organizations {
        uuid id PK
        string name
        string slug UK
        string plan
        string billing_email
        int max_tenants
        int max_users
        jsonb settings
        string status
        timestamptz created_at
        timestamptz updated_at
    }
    
    tenants {
        uuid id PK
        uuid organization_id FK
        string name
        string legal_name
        string tax_id
        string country
        string timezone
        string plan
        string status
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    users {
        uuid id PK
        uuid tenant_id FK
        string firebase_uid UK
        string email
        string first_name
        string last_name
        string role
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    organization_members {
        uuid id PK
        uuid organization_id FK
        uuid user_id FK
        string role
        timestamptz created_at
    }
    
    tenant_members {
        uuid id PK
        uuid tenant_id FK
        uuid user_id FK
        string role
        timestamptz created_at
    }
    
    clients {
        uuid id PK
        uuid tenant_id FK
        string client_organization_id
        string client_entity_id
        string client_service_id
        string label
        string recipient_name
        string vat_number
        string category
        string email_contact
        string phone_contact
        text address
        string country
        string external_reference
        string internal_reference
        decimal payment_score
        int avg_payment_days
        decimal total_invoiced
        decimal total_paid
        date last_invoice_date
        date last_payment_date
        int invoice_count
        string status
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    suppliers {
        uuid id PK
        uuid tenant_id FK
        string name
        string email
        string phone
        text address
        string tax_id
        string iban
        string bic
        int payment_terms_days
        string status
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    bank_connections {
        uuid id PK
        uuid tenant_id FK
        uuid user_id FK
        string provider
        string provider_connection_id
        string provider_user_id
        string status
        timestamptz access_expires_at
        timestamptz last_sync_at
        text last_sync_error
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    bank_accounts {
        uuid id PK
        uuid connection_id FK
        uuid tenant_id FK
        string provider
        string provider_account_id
        string name
        string iban
        string bic
        string currency
        string account_type
        decimal balance
        timestamptz balance_updated_at
        string bank_name
        text bank_logo_url
        string status
        timestamptz last_sync_at
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    transactions {
        uuid id PK
        uuid tenant_id FK
        uuid account_id FK
        uuid supplier_id FK
        uuid client_id FK
        string source_type
        string source_id UK
        jsonb source_raw
        decimal amount
        string currency
        date transaction_date
        date booking_date
        date value_date
        timestamptz added_at
        string payment_method
        string payment_context
        string external_reference
        text description_original
        text description_display
        string category
        string counterparty_name
        string counterparty_iban
        string counterparty_bic
        string status
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    invoices {
        uuid id PK
        uuid tenant_id FK
        uuid provider_id FK
        uuid supplier_id FK
        uuid client_id FK
        string source_type
        string source_id UK
        jsonb source_raw
        string invoice_number
        string external_reference
        date invoice_date
        date due_date
        date payment_expected_date
        decimal amount_excl_vat
        decimal vat_amount
        decimal amount_incl_vat
        string currency
        string payment_method
        string recipient_name
        string customer_name
        string customer_email
        string email_contact
        string phone_contact
        text description
        string invoice_type
        decimal recovery_percent
        string status
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }
    
    matches {
        uuid id PK
        uuid tenant_id FK
        uuid transaction_id FK
        string transaction_type
        uuid crypto_transaction_id FK
        uuid invoice_id FK
        decimal matched_amount
        string match_type
        decimal confidence_score
        text ai_reasoning
        uuid matched_by FK
        string status
        jsonb metadata
        timestamptz created_at
    }
    
    alerts {
        uuid id PK
        uuid tenant_id FK
        uuid user_id FK
        string alert_type
        string title
        text message
        uuid related_match_id FK
        uuid related_invoice_id FK
        string status
        boolean notification_sent
        jsonb metadata
        timestamptz created_at
    }
    
    reports {
        uuid id PK
        uuid tenant_id FK
        string report_type
        date period_start
        date period_end
        jsonb data
        jsonb metadata
        timestamptz generated_at
    }
    
    import_jobs {
        uuid id PK
        uuid tenant_id FK
        uuid user_id FK
        string file_name
        string file_type
        string file_format
        int total_rows
        int processed_rows
        int error_rows
        jsonb errors
        string status
        timestamptz started_at
        timestamptz completed_at
        jsonb metadata
        timestamptz created_at
    }
    
    invoice_providers {
        uuid id PK
        uuid tenant_id FK
        string provider
        string api_key_ref
        string webhook_secret_ref
        string status
        timestamptz last_sync_at
        jsonb metadata
        timestamptz created_at
    }
    
    crypto_transactions {
        uuid id PK
        uuid tenant_id FK
        string wallet_address
        string chain
        string provider
        string tx_hash UK
        decimal amount
        string token_symbol
        string token_address
        string from_address
        string to_address
        timestamptz transaction_date
        decimal gas_used
        decimal gas_price
        string status
        jsonb raw_data
        jsonb metadata
        timestamptz created_at
    }
    
    audit_log {
        bigserial id PK
        uuid tenant_id FK
        uuid user_id FK
        string action
        string resource_type
        uuid resource_id
        jsonb old_values
        jsonb new_values
        inet ip_address
        jsonb metadata
        timestamptz created_at
    }
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: rgba(59,130,246,0.1); border-radius: 8px; border: 1px solid rgba(59,130,246,0.2);">
            <p style="color: #cbd5e1; margin: 0;">
                <strong style="color: #60a5fa;">üí° L√©gende :</strong> Les lignes repr√©sentent les relations Foreign Key (FK) entre les tables. 
                <span class="badge badge-new">NEW</span> indique les nouvelles tables de la v3 (organizations, organization_members, tenant_members, clients).
            </p>
        </div>
    </div>

    <!-- FOOTER -->
    <div style="text-align: center; padding: 40px 20px; color: #475569; font-size: 0.9em;">
        <p style="margin-bottom: 5px;"><strong>Invunion</strong> - Relations Tables v3</p>
        <p>35 relations document√©es ‚Ä¢ 19 tables ‚Ä¢ 2 triggers auto-calcul√©s</p>
        <p style="margin-top: 10px;">Document cr√©√©: 13 f√©vrier 2026</p>
    </div>

</div>
</body>
</html>
